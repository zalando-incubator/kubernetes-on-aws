# {{ if eq .Cluster.Provider "zalando-eks" }}
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: zalando-iam-aws-proxy
  namespace: kube-system
  labels:
    application: kubernetes
    component: zalando-iam-aws-proxy
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: zalando-iam-aws-proxy
  minReplicas: 2
  maxReplicas: {{.Cluster.ConfigItems.eks_zalando_iam_aws_proxy_hpa_max_replicas}}
  metrics:
  - type: ContainerResource
    containerResource:
      name: cpu
      container: proxy
      target:
        type: Utilization
        averageUtilization: {{.Cluster.ConfigItems.eks_zalando_iam_aws_proxy_hpa_cpu_target}}
  - type: ContainerResource
    containerResource:
      name: memory
      container: proxy
      target:
        type: Utilization
        averageUtilization: {{.Cluster.ConfigItems.eks_zalando_iam_aws_proxy_hpa_memory_target}}
# {{ end }}
